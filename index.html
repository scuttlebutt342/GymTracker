<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gym Tracker</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #FF3B30;
            --primary-dark: #D32F2F;
            --secondary: #1C1C1E;
            --surface: #2C2C2E;
            --background: #000000;
            --text: #FFFFFF;
            --text-secondary: #8E8E93;
            --success: #30D158;
            --border: #3A3A3C;
        }

        body {
            font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--background);
            color: var(--text);
            min-height: 100vh;
            padding-bottom: 80px;
            -webkit-font-smoothing: antialiased;
            touch-action: manipulation;
        }

        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            padding: 60px 20px 30px;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -20%;
            width: 300px;
            height: 300px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 50%;
            animation: pulse 4s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.05; }
            50% { transform: scale(1.1); opacity: 0.1; }
        }

        .header h1 {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 48px;
            letter-spacing: 2px;
            position: relative;
            text-shadow: 2px 2px 10px rgba(0, 0, 0, 0.3);
        }

        .date {
            font-size: 14px;
            opacity: 0.9;
            margin-top: 5px;
            font-weight: 500;
        }

        .container {
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
        }

        .workout-card {
            background: var(--surface);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
            border: 1px solid var(--border);
            opacity: 0;
            animation: slideUp 0.4s ease forwards;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .workout-card:nth-child(1) { animation-delay: 0.1s; }
        .workout-card:nth-child(2) { animation-delay: 0.2s; }
        .workout-card:nth-child(3) { animation-delay: 0.3s; }
        .workout-card:nth-child(4) { animation-delay: 0.4s; }
        .workout-card:nth-child(5) { animation-delay: 0.5s; }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .exercise-select {
            width: 100%;
            background: var(--secondary);
            border: 2px solid var(--border);
            color: var(--text);
            padding: 14px 16px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            font-family: 'DM Sans', sans-serif;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg width='12' height='8' viewBox='0 0 12 8' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1L6 6L11 1' stroke='%238E8E93' stroke-width='2' stroke-linecap='round'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 16px center;
            margin-bottom: 16px;
            transition: all 0.2s ease;
        }

        .exercise-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(255, 59, 48, 0.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
        }

        .stat-box {
            background: var(--secondary);
            border-radius: 12px;
            padding: 16px;
            border: 1px solid var(--border);
        }

        .target-reps-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 16px;
        }

        .sets-container {
            margin-top: 12px;
        }

        .set-row {
            display: grid;
            grid-template-columns: auto 1fr 1fr auto;
            gap: 8px;
            align-items: center;
            margin-bottom: 8px;
            padding: 10px;
            background: var(--background);
            border-radius: 8px;
            border: 1px solid var(--border);
        }

        .set-label {
            font-size: 12px;
            font-weight: 700;
            color: var(--text-secondary);
            min-width: 40px;
        }

        .set-input-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .set-input-label {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-secondary);
            font-weight: 600;
        }

        .set-input {
            width: 100%;
            background: var(--surface);
            border: 1px solid var(--border);
            color: var(--text);
            padding: 8px;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 700;
            text-align: center;
            font-family: 'DM Sans', sans-serif;
            transition: all 0.2s ease;
        }

        .set-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(255, 59, 48, 0.1);
        }

        .remove-set-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 20px;
            cursor: pointer;
            padding: 4px;
            line-height: 1;
            transition: all 0.2s ease;
        }

        .remove-set-btn:active {
            transform: scale(0.9);
            color: var(--primary);
        }

        .add-set-btn {
            width: 100%;
            background: var(--secondary);
            border: 2px dashed var(--border);
            color: var(--text-secondary);
            padding: 12px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            font-family: 'DM Sans', sans-serif;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .add-set-btn:active {
            transform: scale(0.98);
            border-color: var(--primary);
            color: var(--primary);
        }

        .stat-label {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-secondary);
            margin-bottom: 8px;
            font-weight: 600;
        }

        .stat-input-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stat-input {
            width: 50px;
            background: var(--background);
            border: 1px solid var(--border);
            color: var(--text);
            padding: 10px;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 700;
            text-align: center;
            font-family: 'DM Sans', sans-serif;
            transition: all 0.2s ease;
        }

        .stat-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(255, 59, 48, 0.1);
        }

        .stat-separator {
            color: var(--text-secondary);
            font-weight: 700;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: var(--secondary);
            border-radius: 3px;
            margin-top: 12px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--success));
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .delete-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 24px;
            cursor: pointer;
            padding: 4px;
            line-height: 1;
            transition: all 0.2s ease;
        }

        .delete-btn:active {
            transform: scale(0.9);
            color: var(--primary);
        }

        .add-btn {
            width: 100%;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border: none;
            color: var(--text);
            padding: 18px;
            border-radius: 16px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-family: 'DM Sans', sans-serif;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 20px rgba(255, 59, 48, 0.3);
            transition: all 0.2s ease;
        }

        .add-btn:active {
            transform: scale(0.98);
            box-shadow: 0 2px 10px rgba(255, 59, 48, 0.3);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 16px;
            opacity: 0.3;
        }

        .empty-state-text {
            font-size: 18px;
            font-weight: 500;
        }

        .summary {
            background: var(--surface);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
        }

        .summary-title {
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-secondary);
            margin-bottom: 12px;
            font-weight: 600;
        }

        .summary-stat {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid var(--border);
        }

        .summary-stat:last-child {
            border-bottom: none;
        }

        .summary-label {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .summary-value {
            font-weight: 700;
            font-size: 16px;
        }

        select option {
            background: var(--secondary);
            color: var(--text);
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(10px);
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
            animation: fadeIn 0.2s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal {
            background: var(--surface);
            border-radius: 20px;
            padding: 24px;
            max-width: 500px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid var(--border);
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 28px;
            letter-spacing: 1px;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 32px;
            cursor: pointer;
            line-height: 1;
            padding: 0;
            transition: all 0.2s ease;
        }

        .modal-close:active {
            transform: scale(0.9);
            color: var(--primary);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-secondary);
            margin-bottom: 8px;
            display: block;
            font-weight: 600;
        }

        .form-input {
            width: 100%;
            background: var(--secondary);
            border: 2px solid var(--border);
            color: var(--text);
            padding: 14px 16px;
            border-radius: 12px;
            font-size: 16px;
            font-family: 'DM Sans', sans-serif;
            transition: all 0.2s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(255, 59, 48, 0.1);
        }

        .btn {
            width: 100%;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border: none;
            color: var(--text);
            padding: 16px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            font-family: 'DM Sans', sans-serif;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.2s ease;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn-secondary {
            background: var(--secondary);
            border: 2px solid var(--border);
            margin-top: 12px;
        }

        .history-item {
            background: var(--secondary);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            border: 1px solid var(--border);
        }

        .history-date {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .history-exercise {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid var(--border);
        }

        .history-exercise:last-child {
            border-bottom: none;
        }

        .history-name {
            font-weight: 600;
            color: var(--text);
        }

        .history-stats {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .action-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .action-btn {
            background: var(--surface);
            border: 2px solid var(--border);
            color: var(--text);
            padding: 12px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 700;
            cursor: pointer;
            font-family: 'DM Sans', sans-serif;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            min-height: 60px;
        }

        .action-btn span {
            font-size: 20px;
        }

        .action-btn:active {
            transform: scale(0.98);
            border-color: var(--primary);
        }

        .exercise-list {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .exercise-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: var(--secondary);
            border-radius: 8px;
            margin-bottom: 8px;
            border: 1px solid var(--border);
        }

        .exercise-name {
            font-weight: 600;
        }

        .remove-exercise-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 20px;
            cursor: pointer;
            padding: 4px;
            line-height: 1;
            transition: all 0.2s ease;
        }

        .remove-exercise-btn:active {
            transform: scale(0.9);
            color: var(--primary);
        }

        .empty-history {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
        }

        .empty-history-icon {
            font-size: 48px;
            margin-bottom: 12px;
            opacity: 0.3;
        }

        .template-card {
            background: var(--secondary);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            border: 1px solid var(--border);
        }

        .template-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .template-name {
            font-weight: 700;
            font-size: 18px;
            color: var(--text);
        }

        .template-actions {
            display: flex;
            gap: 8px;
        }

        .template-action-btn {
            background: var(--background);
            border: 1px solid var(--border);
            color: var(--text);
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            font-family: 'DM Sans', sans-serif;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.2s ease;
        }

        .template-action-btn:active {
            transform: scale(0.95);
        }

        .template-action-btn.load {
            border-color: var(--success);
            color: var(--success);
        }

        .template-action-btn.delete {
            border-color: var(--primary);
            color: var(--primary);
        }

        .template-exercise-list {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .template-exercise-item {
            padding: 6px 0;
            border-bottom: 1px solid var(--border);
        }

        .template-exercise-item:last-child {
            border-bottom: none;
        }

        .save-template-section {
            background: var(--secondary);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
            border: 2px dashed var(--border);
        }

        .save-template-title {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-secondary);
            margin-bottom: 12px;
            font-weight: 600;
        }

        .chart-container {
            background: var(--secondary);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
            border: 1px solid var(--border);
        }

        .chart-title {
            font-weight: 700;
            font-size: 18px;
            color: var(--text);
            margin-bottom: 16px;
        }

        .chart-canvas {
            width: 100%;
            height: 250px;
        }

        .exercise-filter {
            margin-bottom: 20px;
        }

        .filter-label {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-secondary);
            margin-bottom: 8px;
            display: block;
            font-weight: 600;
        }

        .metric-tabs {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-bottom: 16px;
        }

        .metric-tab {
            background: var(--secondary);
            border: 2px solid var(--border);
            color: var(--text-secondary);
            padding: 10px 6px;
            border-radius: 8px;
            font-size: 11px;
            font-weight: 700;
            cursor: pointer;
            font-family: 'DM Sans', sans-serif;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.2s ease;
            text-align: center;
        }

        .metric-tab.active {
            background: var(--primary);
            border-color: var(--primary);
            color: var(--text);
        }

        .metric-tab:active {
            transform: scale(0.98);
        }

        .stats-summary {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 16px;
        }

        .stat-card {
            background: var(--background);
            border-radius: 8px;
            padding: 12px;
            border: 1px solid var(--border);
        }

        .stat-card-label {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-secondary);
            margin-bottom: 4px;
            font-weight: 600;
        }

        .stat-card-value {
            font-size: 20px;
            font-weight: 700;
            color: var(--text);
        }

        .stat-card-trend {
            font-size: 12px;
            margin-top: 4px;
        }

        .trend-up {
            color: var(--success);
        }

        .trend-down {
            color: var(--primary);
        }

        .no-data-message {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>GYM TRACKER</h1>
        <div class="date" id="currentDate"></div>
    </div>

    <div class="container">
        <div class="action-buttons">
            <button class="action-btn" onclick="openAnalyticsModal()">
                <span>üìà</span>
                Analytics
            </button>
            <button class="action-btn" onclick="openTemplatesModal()">
                <span>üìã</span>
                Templates
            </button>
            <button class="action-btn" onclick="openManageExercisesModal()">
                <span>‚öôÔ∏è</span>
                Exercises
            </button>
            <button class="action-btn" onclick="openHistoryModal()">
                <span>üìä</span>
                History
            </button>
        </div>

        <div class="summary" id="summary" style="display: none;">
            <div class="summary-title">Today's Summary</div>
            <div class="summary-stat">
                <span class="summary-label">Total Exercises</span>
                <span class="summary-value" id="totalExercises">0</span>
            </div>
            <div class="summary-stat">
                <span class="summary-label">Completed Sets</span>
                <span class="summary-value" id="completedSets">0</span>
            </div>
            <div class="summary-stat">
                <span class="summary-label">Overall Progress</span>
                <span class="summary-value" id="overallProgress">0%</span>
            </div>
        </div>

        <div id="workoutList"></div>

        <div class="empty-state" id="emptyState">
            <div class="empty-state-icon">üí™</div>
            <div class="empty-state-text">Add your first exercise to start tracking</div>
        </div>

        <button class="add-btn" onclick="addExercise()">
            <span style="font-size: 24px;">+</span>
            Add Exercise
        </button>

        <button class="add-btn" onclick="saveWorkout()" style="margin-top: 12px; background: linear-gradient(135deg, var(--success), #28A745);">
            <span style="font-size: 20px;">üíæ</span>
            Save Workout
        </button>
    </div>

    <!-- Manage Exercises Modal -->
    <div class="modal-overlay" id="manageExercisesModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">MANAGE EXERCISES</h2>
                <button class="modal-close" onclick="closeManageExercisesModal()">√ó</button>
            </div>
            
            <div class="form-group">
                <label class="form-label">Add New Exercise</label>
                <input type="text" 
                       class="form-input" 
                       id="newExerciseName" 
                       placeholder="Enter exercise name"
                       onkeypress="handleExerciseKeyPress(event)">
            </div>
            
            <button class="btn" onclick="addCustomExercise()">Add Exercise</button>
            
            <div class="form-group" style="margin-top: 24px;">
                <label class="form-label">Your Exercises (${exercises.length})</label>
                <div class="exercise-list" id="exerciseList"></div>
            </div>
        </div>
    </div>

    <!-- History Modal -->
    <div class="modal-overlay" id="historyModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">WORKOUT HISTORY</h2>
                <button class="modal-close" onclick="closeHistoryModal()">√ó</button>
            </div>
            
            <div id="historyList"></div>
            
            <button class="btn btn-secondary" onclick="clearHistory()">Clear All History</button>
        </div>
    </div>

    <!-- Templates Modal -->
    <div class="modal-overlay" id="templatesModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">WORKOUT TEMPLATES</h2>
                <button class="modal-close" onclick="closeTemplatesModal()">√ó</button>
            </div>
            
            <div class="save-template-section">
                <div class="save-template-title">Create New Template</div>
                <div class="form-group">
                    <label class="form-label">Template Name</label>
                    <input type="text" 
                           class="form-input" 
                           id="templateName" 
                           placeholder="e.g., Push Day, Leg Day, Upper Body"
                           onkeypress="handleTemplateKeyPress(event)">
                </div>
                <button class="btn" onclick="saveCurrentAsTemplate()">Save Current Workout as Template</button>
            </div>

            <div class="form-group">
                <label class="form-label">Saved Templates (${templates.length})</label>
                <div id="templatesList"></div>
            </div>
        </div>
    </div>

    <!-- Analytics Modal -->
    <div class="modal-overlay" id="analyticsModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">ANALYTICS</h2>
                <button class="modal-close" onclick="closeAnalyticsModal()">√ó</button>
            </div>

            <div class="exercise-filter">
                <label class="filter-label">Select Exercise</label>
                <select class="exercise-select" id="analyticsExerciseSelect" onchange="updateAnalyticsChart()">
                </select>
            </div>

            <div class="metric-tabs" id="metricTabs">
                <button class="metric-tab active" onclick="changeMetric('powerScore')">Power Score</button>
                <button class="metric-tab" onclick="changeMetric('volume')">Volume</button>
                <button class="metric-tab" onclick="changeMetric('maxWeight')">Max Weight</button>
                <button class="metric-tab" onclick="changeMetric('totalReps')">Total Reps</button>
            </div>

            <div id="analyticsContent"></div>
        </div>
    </div>

    <script>
        let exercises = [
            'Bench Press',
            'Squat',
            'Deadlift',
            'Overhead Press',
            'Barbell Row',
            'Pull-ups',
            'Dips',
            'Bicep Curls',
            'Tricep Extensions',
            'Leg Press',
            'Lunges',
            'Leg Curls',
            'Leg Extensions',
            'Calf Raises',
            'Lateral Raises',
            'Face Pulls',
            'Cable Flyes',
            'Incline Press',
            'Romanian Deadlift',
            'Hip Thrusts'
        ];

        let workouts = [];
        let workoutHistory = [];
        let templates = [];
        let currentMetric = 'powerScore';
        let currentChart = null;

        function updateDate() {
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('currentDate').textContent = new Date().toLocaleDateString('en-US', options);
        }

        function addExercise() {
            const id = Date.now();
            const workout = {
                id: id,
                exercise: exercises[0],
                targetSets: 3,
                targetReps: 10,
                sets: [] // Array to store each set with reps and weight
            };
            
            workouts.push(workout);
            renderWorkouts();
            updateSummary();
        }

        function deleteExercise(id) {
            workouts = workouts.filter(w => w.id !== id);
            renderWorkouts();
            updateSummary();
        }

        function updateWorkout(id, field, value) {
            const workout = workouts.find(w => w.id === id);
            if (workout) {
                workout[field] = value;
                updateSummary();
                updateProgress(id);
            }
        }

        function addSet(workoutId) {
            const workout = workouts.find(w => w.id === workoutId);
            if (!workout) return;

            workout.sets.push({
                reps: 0,
                weight: 0
            });

            renderWorkouts();
            updateSummary();
        }

        function removeSet(workoutId, setIndex) {
            const workout = workouts.find(w => w.id === workoutId);
            if (!workout) return;

            workout.sets.splice(setIndex, 1);
            renderWorkouts();
            updateSummary();
        }

        function updateSet(workoutId, setIndex, field, value) {
            const workout = workouts.find(w => w.id === workoutId);
            if (!workout || !workout.sets[setIndex]) return;

            workout.sets[setIndex][field] = value;
            updateProgress(workoutId);
            updateSummary();
        }

        function updateProgress(id) {
            const workout = workouts.find(w => w.id === id);
            if (!workout) return;

            const completedSets = workout.sets.length;
            const targetSets = workout.targetSets;
            const setsProgress = Math.min((completedSets / targetSets) * 100, 100);

            // Calculate reps progress (average reps across completed sets vs target)
            let repsProgress = 0;
            if (workout.sets.length > 0) {
                const avgReps = workout.sets.reduce((sum, set) => sum + (set.reps || 0), 0) / workout.sets.length;
                repsProgress = Math.min((avgReps / workout.targetReps) * 100, 100);
            }

            const overallProgress = (setsProgress + repsProgress) / 2;

            const progressBar = document.querySelector(`#progress-${id}`);
            if (progressBar) {
                progressBar.style.width = overallProgress + '%';
            }
        }

        function renderWorkouts() {
            const container = document.getElementById('workoutList');
            const emptyState = document.getElementById('emptyState');
            
            if (workouts.length === 0) {
                container.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }

            emptyState.style.display = 'none';
            
            container.innerHTML = workouts.map((workout, index) => `
                <div class="workout-card" style="animation-delay: ${index * 0.1}s">
                    <div class="card-header">
                        <button class="delete-btn" onclick="deleteExercise(${workout.id})">√ó</button>
                    </div>
                    
                    <select class="exercise-select" onchange="updateWorkout(${workout.id}, 'exercise', this.value)">
                        ${exercises.map(ex => `<option value="${ex}" ${ex === workout.exercise ? 'selected' : ''}>${ex}</option>`).join('')}
                    </select>

                    <div class="stats-grid">
                        <div class="stat-box">
                            <div class="target-reps-section">
                                <div>
                                    <div class="stat-label">Target Sets</div>
                                    <input type="number" 
                                           class="stat-input" 
                                           value="${workout.targetSets}" 
                                           min="1"
                                           style="width: 100%;"
                                           onchange="updateWorkout(${workout.id}, 'targetSets', parseInt(this.value) || 1)">
                                </div>
                                <div>
                                    <div class="stat-label">Target Reps</div>
                                    <input type="number" 
                                           class="stat-input" 
                                           value="${workout.targetReps}" 
                                           min="1"
                                           style="width: 100%;"
                                           onchange="updateWorkout(${workout.id}, 'targetReps', parseInt(this.value) || 1)">
                                </div>
                            </div>

                            <div class="sets-container">
                                ${workout.sets.map((set, setIndex) => `
                                    <div class="set-row">
                                        <span class="set-label">Set ${setIndex + 1}</span>
                                        <div class="set-input-group">
                                            <label class="set-input-label">Weight</label>
                                            <input type="number" 
                                                   class="set-input" 
                                                   value="${set.weight || ''}" 
                                                   placeholder="lbs"
                                                   step="2.5"
                                                   onchange="updateSet(${workout.id}, ${setIndex}, 'weight', parseFloat(this.value) || 0)">
                                        </div>
                                        <div class="set-input-group">
                                            <label class="set-input-label">Reps</label>
                                            <input type="number" 
                                                   class="set-input" 
                                                   value="${set.reps || ''}" 
                                                   placeholder="reps"
                                                   min="0"
                                                   onchange="updateSet(${workout.id}, ${setIndex}, 'reps', parseInt(this.value) || 0)">
                                        </div>
                                        <button class="remove-set-btn" onclick="removeSet(${workout.id}, ${setIndex})">√ó</button>
                                    </div>
                                `).join('')}
                                <button class="add-set-btn" onclick="addSet(${workout.id})">
                                    <span style="font-size: 16px;">+</span>
                                    Add Set
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-${workout.id}" style="width: 0%"></div>
                    </div>
                </div>
            `).join('');

            // Update all progress bars after render
            workouts.forEach(w => updateProgress(w.id));
        }

        function updateSummary() {
            const summary = document.getElementById('summary');
            
            if (workouts.length === 0) {
                summary.style.display = 'none';
                return;
            }

            summary.style.display = 'block';
            
            const totalExercises = workouts.length;
            const completedSets = workouts.reduce((sum, w) => sum + w.sets.length, 0);
            const totalProgress = workouts.reduce((sum, w) => {
                const completedSets = w.sets.length;
                const targetSets = w.targetSets;
                const setsProgress = Math.min((completedSets / targetSets) * 100, 100);
                
                let repsProgress = 0;
                if (w.sets.length > 0) {
                    const avgReps = w.sets.reduce((rSum, set) => rSum + (set.reps || 0), 0) / w.sets.length;
                    repsProgress = Math.min((avgReps / w.targetReps) * 100, 100);
                }
                
                return sum + ((setsProgress + repsProgress) / 2);
            }, 0);
            const overallProgress = workouts.length > 0 ? Math.round(totalProgress / workouts.length) : 0;

            document.getElementById('totalExercises').textContent = totalExercises;
            document.getElementById('completedSets').textContent = completedSets;
            document.getElementById('overallProgress').textContent = overallProgress + '%';
        }

        // Initialize
        updateDate();
        renderWorkouts();

        // Persistent storage functions
        async function loadFromStorage() {
            try {
                // Load exercises
                const exercisesResult = await window.storage.get('gym-exercises');
                if (exercisesResult && exercisesResult.value) {
                    exercises = JSON.parse(exercisesResult.value);
                }

                // Load workout history
                const historyResult = await window.storage.get('gym-history');
                if (historyResult && historyResult.value) {
                    workoutHistory = JSON.parse(historyResult.value);
                }

                // Load templates
                const templatesResult = await window.storage.get('gym-templates');
                if (templatesResult && templatesResult.value) {
                    templates = JSON.parse(templatesResult.value);
                }
            } catch (error) {
                console.log('No stored data found, using defaults');
            }
        }

        async function saveExercisesToStorage() {
            try {
                await window.storage.set('gym-exercises', JSON.stringify(exercises));
            } catch (error) {
                console.error('Failed to save exercises:', error);
            }
        }

        async function saveHistoryToStorage() {
            try {
                await window.storage.set('gym-history', JSON.stringify(workoutHistory));
            } catch (error) {
                console.error('Failed to save history:', error);
            }
        }

        async function saveTemplatesToStorage() {
            try {
                await window.storage.set('gym-templates', JSON.stringify(templates));
            } catch (error) {
                console.error('Failed to save templates:', error);
            }
        }

        // Add custom exercise
        function addCustomExercise() {
            const input = document.getElementById('newExerciseName');
            const exerciseName = input.value.trim();
            
            if (!exerciseName) {
                alert('Please enter an exercise name');
                return;
            }
            
            if (exercises.includes(exerciseName)) {
                alert('This exercise already exists');
                return;
            }
            
            exercises.push(exerciseName);
            exercises.sort();
            input.value = '';
            
            saveExercisesToStorage();
            renderExerciseList();
            renderWorkouts();
        }

        function handleExerciseKeyPress(event) {
            if (event.key === 'Enter') {
                addCustomExercise();
            }
        }

        function removeExercise(exerciseName) {
            if (confirm(`Remove "${exerciseName}" from your exercise list?`)) {
                exercises = exercises.filter(ex => ex !== exerciseName);
                saveExercisesToStorage();
                renderExerciseList();
                renderWorkouts();
            }
        }

        function renderExerciseList() {
            const listContainer = document.getElementById('exerciseList');
            
            listContainer.innerHTML = exercises.map(ex => `
                <div class="exercise-item">
                    <span class="exercise-name">${ex}</span>
                    <button class="remove-exercise-btn" onclick="removeExercise('${ex.replace(/'/g, "\\'")}')">√ó</button>
                </div>
            `).join('');

            // Update modal title with count
            const modalContent = document.querySelector('#manageExercisesModal .modal');
            if (modalContent) {
                const label = modalContent.querySelector('.form-label:last-of-type');
                if (label) {
                    label.textContent = `Your Exercises (${exercises.length})`;
                }
            }
        }

        // Save workout to history
        async function saveWorkout() {
            if (workouts.length === 0) {
                alert('Add some exercises first!');
                return;
            }

            const workoutData = {
                date: new Date().toISOString(),
                exercises: workouts.map(w => ({
                    name: w.exercise,
                    targetReps: w.targetReps,
                    targetSets: w.targetSets,
                    sets: w.sets.map(set => ({
                        reps: set.reps,
                        weight: set.weight
                    }))
                }))
            };

            workoutHistory.unshift(workoutData);
            
            // Keep only last 50 workouts
            if (workoutHistory.length > 50) {
                workoutHistory = workoutHistory.slice(0, 50);
            }

            await saveHistoryToStorage();
            
            alert('Workout saved to history!');
            
            // Clear current workout
            workouts = [];
            renderWorkouts();
            updateSummary();
        }

        // Modal functions
        function openManageExercisesModal() {
            document.getElementById('manageExercisesModal').classList.add('active');
            renderExerciseList();
        }

        function closeManageExercisesModal() {
            document.getElementById('manageExercisesModal').classList.remove('active');
        }

        function openHistoryModal() {
            document.getElementById('historyModal').classList.add('active');
            renderHistory();
        }

        function closeHistoryModal() {
            document.getElementById('historyModal').classList.remove('active');
        }

        function renderHistory() {
            const historyContainer = document.getElementById('historyList');
            
            if (workoutHistory.length === 0) {
                historyContainer.innerHTML = `
                    <div class="empty-history">
                        <div class="empty-history-icon">üìä</div>
                        <div>No workout history yet</div>
                    </div>
                `;
                return;
            }

            historyContainer.innerHTML = workoutHistory.map((workout, index) => {
                const date = new Date(workout.date);
                const formattedDate = date.toLocaleDateString('en-US', { 
                    weekday: 'short', 
                    year: 'numeric', 
                    month: 'short', 
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });

                return `
                    <div class="history-item">
                        <div class="history-date">${formattedDate}</div>
                        ${workout.exercises.map(ex => {
                            const totalSets = ex.sets ? ex.sets.length : 0;
                            const setDetails = ex.sets && ex.sets.length > 0 
                                ? ex.sets.map((set, idx) => 
                                    `${set.weight || 0}lbs √ó ${set.reps || 0}`
                                  ).join(', ')
                                : 'No sets recorded';
                            
                            return `
                                <div class="history-exercise">
                                    <span class="history-name">${ex.name}</span>
                                    <span class="history-stats">${totalSets} sets</span>
                                </div>
                                <div style="font-size: 12px; color: var(--text-secondary); padding: 4px 0 8px 0;">
                                    ${setDetails}
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
            }).join('');
        }

        async function clearHistory() {
            if (confirm('Are you sure you want to clear all workout history? This cannot be undone.')) {
                workoutHistory = [];
                await saveHistoryToStorage();
                renderHistory();
            }
        }

        // Template functions
        async function saveCurrentAsTemplate() {
            const templateNameInput = document.getElementById('templateName');
            const templateName = templateNameInput.value.trim();
            
            if (!templateName) {
                alert('Please enter a template name');
                return;
            }
            
            if (workouts.length === 0) {
                alert('Add some exercises to your current workout first');
                return;
            }

            const template = {
                id: Date.now(),
                name: templateName,
                exercises: workouts.map(w => ({
                    exercise: w.exercise,
                    targetReps: w.targetReps,
                    targetSets: w.targetSets
                })),
                createdAt: new Date().toISOString()
            };

            templates.push(template);
            await saveTemplatesToStorage();
            
            templateNameInput.value = '';
            renderTemplates();
            
            alert(`Template "${templateName}" saved!`);
        }

        function handleTemplateKeyPress(event) {
            if (event.key === 'Enter') {
                saveCurrentAsTemplate();
            }
        }

        function loadTemplate(templateId) {
            const template = templates.find(t => t.id === templateId);
            if (!template) return;

            if (workouts.length > 0) {
                if (!confirm('This will replace your current workout. Continue?')) {
                    return;
                }
            }

            workouts = template.exercises.map(ex => ({
                id: Date.now() + Math.random(),
                exercise: ex.exercise,
                targetReps: ex.targetReps,
                targetSets: ex.targetSets,
                sets: []
            }));

            renderWorkouts();
            updateSummary();
            closeTemplatesModal();
            
            alert(`Template "${template.name}" loaded!`);
        }

        async function deleteTemplate(templateId) {
            const template = templates.find(t => t.id === templateId);
            if (!template) return;

            if (confirm(`Delete template "${template.name}"?`)) {
                templates = templates.filter(t => t.id !== templateId);
                await saveTemplatesToStorage();
                renderTemplates();
            }
        }

        function renderTemplates() {
            const templatesContainer = document.getElementById('templatesList');
            
            if (templates.length === 0) {
                templatesContainer.innerHTML = `
                    <div class="empty-history">
                        <div class="empty-history-icon">üìã</div>
                        <div>No templates saved yet</div>
                    </div>
                `;
                return;
            }

            templatesContainer.innerHTML = templates.map(template => `
                <div class="template-card">
                    <div class="template-header">
                        <span class="template-name">${template.name}</span>
                        <div class="template-actions">
                            <button class="template-action-btn load" onclick="loadTemplate(${template.id})">Load</button>
                            <button class="template-action-btn delete" onclick="deleteTemplate(${template.id})">Delete</button>
                        </div>
                    </div>
                    <div class="template-exercise-list">
                        ${template.exercises.map(ex => `
                            <div class="template-exercise-item">
                                ${ex.exercise} ‚Ä¢ ${ex.targetSets} sets √ó ${ex.targetReps} reps
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');

            // Update count in label
            const modalContent = document.querySelector('#templatesModal .modal');
            if (modalContent) {
                const label = modalContent.querySelector('.form-label:last-of-type');
                if (label) {
                    label.textContent = `Saved Templates (${templates.length})`;
                }
            }
        }

        function openTemplatesModal() {
            document.getElementById('templatesModal').classList.add('active');
            renderTemplates();
        }

        function closeTemplatesModal() {
            document.getElementById('templatesModal').classList.remove('active');
        }

        // Analytics functions
        function openAnalyticsModal() {
            document.getElementById('analyticsModal').classList.add('active');
            populateAnalyticsExercises();
            updateAnalyticsChart();
        }

        function closeAnalyticsModal() {
            document.getElementById('analyticsModal').classList.remove('active');
            if (currentChart) {
                currentChart.destroy();
                currentChart = null;
            }
        }

        function populateAnalyticsExercises() {
            const select = document.getElementById('analyticsExerciseSelect');
            
            // Get unique exercises from history
            const exercisesInHistory = new Set();
            workoutHistory.forEach(workout => {
                workout.exercises.forEach(ex => {
                    exercisesInHistory.add(ex.name);
                });
            });

            if (exercisesInHistory.size === 0) {
                select.innerHTML = '<option>No workout history available</option>';
                return;
            }

            const sortedExercises = Array.from(exercisesInHistory).sort();
            select.innerHTML = sortedExercises.map(ex => 
                `<option value="${ex}">${ex}</option>`
            ).join('');
        }

        function changeMetric(metric) {
            currentMetric = metric;
            
            // Update active tab
            document.querySelectorAll('.metric-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            updateAnalyticsChart();
        }

        function calculateExerciseData(exerciseName) {
            const exerciseData = [];

            workoutHistory.forEach(workout => {
                const exercise = workout.exercises.find(ex => ex.name === exerciseName);
                if (exercise && exercise.sets && exercise.sets.length > 0) {
                    const date = new Date(workout.date);
                    
                    // Calculate metrics
                    let totalVolume = 0;
                    let maxWeight = 0;
                    let totalReps = 0;
                    let totalSets = exercise.sets.length;

                    exercise.sets.forEach(set => {
                        const weight = set.weight || 0;
                        const reps = set.reps || 0;
                        totalVolume += weight * reps;
                        maxWeight = Math.max(maxWeight, weight);
                        totalReps += reps;
                    });

                    // Calculate Power Score - a composite metric
                    // Formula: (Volume √ó Intensity Factor √ó Density Factor)
                    // Intensity Factor: Normalized by max weight (rewards heavier lifts)
                    // Density Factor: Accounts for work done in sets (volume per set)
                    const avgRepsPerSet = totalReps / totalSets;
                    const intensityFactor = maxWeight > 0 ? (maxWeight / 100) : 1; // Normalize intensity
                    const densityFactor = avgRepsPerSet / 10; // Normalize density (10 reps as baseline)
                    const powerScore = totalVolume * (1 + (intensityFactor * 0.3)) * (1 + (densityFactor * 0.2));

                    exerciseData.push({
                        date: date,
                        volume: totalVolume,
                        maxWeight: maxWeight,
                        totalReps: totalReps,
                        powerScore: Math.round(powerScore),
                        sets: exercise.sets
                    });
                }
            });

            // Sort by date (oldest first for chart)
            return exerciseData.sort((a, b) => a.date - b.date);
        }

        function updateAnalyticsChart() {
            const select = document.getElementById('analyticsExerciseSelect');
            const exerciseName = select.value;
            const contentDiv = document.getElementById('analyticsContent');

            if (!exerciseName || exerciseName === 'No workout history available') {
                contentDiv.innerHTML = `
                    <div class="no-data-message">
                        Complete some workouts to see analytics!
                    </div>
                `;
                return;
            }

            const data = calculateExerciseData(exerciseName);

            if (data.length === 0) {
                contentDiv.innerHTML = `
                    <div class="no-data-message">
                        No data available for this exercise yet.
                    </div>
                `;
                return;
            }

            // Prepare chart data based on current metric
            let chartData, yAxisLabel, chartTitle, metricExplanation;
            
            switch(currentMetric) {
                case 'powerScore':
                    chartData = data.map(d => d.powerScore);
                    yAxisLabel = 'Power Score';
                    chartTitle = 'Power Score per Workout';
                    metricExplanation = 'Combines volume, intensity (max weight), and density (reps/set) into one comprehensive metric';
                    break;
                case 'volume':
                    chartData = data.map(d => d.volume);
                    yAxisLabel = 'Total Volume (lbs)';
                    chartTitle = 'Total Volume per Workout';
                    metricExplanation = 'Total weight lifted (weight √ó reps across all sets)';
                    break;
                case 'maxWeight':
                    chartData = data.map(d => d.maxWeight);
                    yAxisLabel = 'Weight (lbs)';
                    chartTitle = 'Max Weight per Workout';
                    metricExplanation = 'Heaviest weight used in any single set';
                    break;
                case 'totalReps':
                    chartData = data.map(d => d.totalReps);
                    yAxisLabel = 'Total Reps';
                    chartTitle = 'Total Reps per Workout';
                    metricExplanation = 'Combined reps across all sets';
                    break;
            }

            const labels = data.map((d, idx) => {
                const date = d.date;
                return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
            });

            // Calculate statistics
            const latestValue = chartData[chartData.length - 1];
            const previousValue = chartData.length > 1 ? chartData[chartData.length - 2] : latestValue;
            const changePercent = previousValue !== 0 
                ? (((latestValue - previousValue) / previousValue) * 100).toFixed(1)
                : 0;
            const avgValue = (chartData.reduce((a, b) => a + b, 0) / chartData.length).toFixed(0);
            const maxValue = Math.max(...chartData);

            // Render chart and stats
            contentDiv.innerHTML = `
                <div class="chart-container">
                    <div class="chart-title">${chartTitle}</div>
                    <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 12px; line-height: 1.4;">
                        ${metricExplanation}
                    </div>
                    <canvas id="analyticsChart" class="chart-canvas"></canvas>
                </div>
                <div class="stats-summary">
                    <div class="stat-card">
                        <div class="stat-card-label">Latest</div>
                        <div class="stat-card-value">${latestValue.toLocaleString()}</div>
                        <div class="stat-card-trend ${changePercent >= 0 ? 'trend-up' : 'trend-down'}">
                            ${changePercent >= 0 ? '‚Üë' : '‚Üì'} ${Math.abs(changePercent)}% vs previous
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-label">Average</div>
                        <div class="stat-card-value">${avgValue}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-label">Peak</div>
                        <div class="stat-card-value">${maxValue.toLocaleString()}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-label">Workouts</div>
                        <div class="stat-card-value">${data.length}</div>
                    </div>
                </div>
            `;

            // Destroy previous chart if exists
            if (currentChart) {
                currentChart.destroy();
            }

            // Create new chart
            const ctx = document.getElementById('analyticsChart').getContext('2d');
            currentChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: yAxisLabel,
                        data: chartData,
                        borderColor: '#FF3B30',
                        backgroundColor: 'rgba(255, 59, 48, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#FF3B30',
                        pointBorderColor: '#FFFFFF',
                        pointBorderWidth: 2,
                        pointRadius: 5,
                        pointHoverRadius: 7
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: '#2C2C2E',
                            titleColor: '#FFFFFF',
                            bodyColor: '#FFFFFF',
                            borderColor: '#3A3A3C',
                            borderWidth: 1,
                            padding: 12,
                            displayColors: false,
                            callbacks: {
                                label: function(context) {
                                    return `${yAxisLabel}: ${context.parsed.y.toLocaleString()}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: '#3A3A3C',
                                drawBorder: false
                            },
                            ticks: {
                                color: '#8E8E93',
                                font: {
                                    family: 'DM Sans',
                                    size: 12
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: false,
                                drawBorder: false
                            },
                            ticks: {
                                color: '#8E8E93',
                                font: {
                                    family: 'DM Sans',
                                    size: 12
                                },
                                maxRotation: 45,
                                minRotation: 45
                            }
                        }
                    }
                }
            });
        }

        // Close modals when clicking outside
        document.getElementById('manageExercisesModal').addEventListener('click', (e) => {
            if (e.target.id === 'manageExercisesModal') {
                closeManageExercisesModal();
            }
        });

        document.getElementById('historyModal').addEventListener('click', (e) => {
            if (e.target.id === 'historyModal') {
                closeHistoryModal();
            }
        });

        document.getElementById('templatesModal').addEventListener('click', (e) => {
            if (e.target.id === 'templatesModal') {
                closeTemplatesModal();
            }
        });

        document.getElementById('analyticsModal').addEventListener('click', (e) => {
            if (e.target.id === 'analyticsModal') {
                closeAnalyticsModal();
            }
        });

        // Load data on startup
        loadFromStorage().then(() => {
            renderWorkouts();
            updateSummary();
        });
    </script>
</body>
</html>
